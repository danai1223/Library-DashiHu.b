local Library = {}

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local LP = Players.LocalPlayer

local function tween(o,p,t)
	TweenService:Create(o,TweenInfo.new(t or 0.25,Enum.EasingStyle.Quint,Enum.EasingDirection.Out),p):Play()
end

function Library:CreateWindow(cfg)
	local Window = {}

	local gui = Instance.new("ScreenGui")
	gui.Name = "DashiHub"
	gui.ResetOnSpawn = false
	gui.Parent = LP:WaitForChild("PlayerGui")

	-- Floating Button
	local openBtn = Instance.new("TextButton", gui)
	openBtn.Size = UDim2.fromOffset(48,48)
	openBtn.Position = UDim2.fromScale(0.03,0.55)
	openBtn.Text = "â‰¡"
	openBtn.Font = Enum.Font.GothamBold
	openBtn.TextSize = 20
	openBtn.BackgroundColor3 = Color3.fromRGB(0,120,255)
	openBtn.TextColor3 = Color3.new(1,1,1)
	Instance.new("UICorner", openBtn).CornerRadius = UDim.new(1,0)

	-- Main
	local main = Instance.new("Frame", gui)
	main.AnchorPoint = Vector2.new(0.5,0.5)
	main.Position = UDim2.fromScale(0.5,0.5)
	main.Size = UDim2.fromScale(0.65,0.7)
	main.BackgroundColor3 = Color3.fromRGB(15,15,18)
	main.Visible = true
	Instance.new("UICorner", main).CornerRadius = UDim.new(0,16)

	openBtn.MouseButton1Click:Connect(function()
		main.Visible = not main.Visible
	end)

	-- Header
	local header = Instance.new("TextLabel", main)
	header.Size = UDim2.new(1,0,0,46)
	header.BackgroundTransparency = 1
	header.Text = cfg.Title or "Dashi Hub"
	header.Font = Enum.Font.GothamBold
	header.TextSize = 20
	header.TextColor3 = Color3.fromRGB(0,150,255)

	-- Body
	local body = Instance.new("Frame", main)
	body.Position = UDim2.fromOffset(0,46)
	body.Size = UDim2.new(1,0,1,-46)
	body.BackgroundTransparency = 1

	-- Sidebar
	local side = Instance.new("Frame", body)
	side.Size = UDim2.fromScale(0.25,1)
	side.BackgroundColor3 = Color3.fromRGB(12,12,15)
	Instance.new("UICorner", side).CornerRadius = UDim.new(0,16)

	local sideList = Instance.new("UIListLayout", side)
	sideList.Padding = UDim.new(0,6)

	-- Content
	local content = Instance.new("Frame", body)
	content.Position = UDim2.fromScale(0.27,0)
	content.Size = UDim2.fromScale(0.73,1)
	content.BackgroundTransparency = 1

	local Tabs = {}

	function Window:CreateTab(name)
		local Tab = {}

		local btn = Instance.new("TextButton", side)
		btn.Size = UDim2.new(1,0,0,40)
		btn.Text = name
		btn.Font = Enum.Font.Gotham
		btn.TextSize = 14
		btn.TextColor3 = Color3.fromRGB(180,180,180)
		btn.BackgroundTransparency = 1

		local frame = Instance.new("Frame", content)
		frame.Size = UDim2.fromScale(1,1)
		frame.Visible = false
		frame.BackgroundTransparency = 1

		local layout = Instance.new("UIListLayout", frame)
		layout.Padding = UDim.new(0,10)
		layout.SortOrder = Enum.SortOrder.LayoutOrder

		btn.MouseButton1Click:Connect(function()
			for _,t in pairs(Tabs) do
				t.Frame.Visible = false
				t.Button.TextColor3 = Color3.fromRGB(180,180,180)
			end
			frame.Visible = true
			btn.TextColor3 = Color3.fromRGB(0,150,255)
		end)

		table.insert(Tabs,{Frame=frame,Button=btn})
		if #Tabs == 1 then
			frame.Visible = true
			btn.TextColor3 = Color3.fromRGB(0,150,255)
		end

		local function Card(h)
			local c = Instance.new("Frame", frame)
			c.Size = UDim2.new(1,-10,0,h)
			c.BackgroundColor3 = Color3.fromRGB(22,22,26)
			Instance.new("UICorner", c).CornerRadius = UDim.new(0,12)
			return c
		end

		function Tab:AddToggle(cfg)
			local c = Card(50)

			local txt = Instance.new("TextLabel", c)
			txt.Text = cfg.Text
			txt.Font = Enum.Font.Gotham
			txt.TextSize = 14
			txt.TextColor3 = Color3.new(1,1,1)
			txt.BackgroundTransparency = 1
			txt.Position = UDim2.fromOffset(12,0)
			txt.Size = UDim2.new(0.6,0,1,0)

			local sw = Instance.new("TextButton", c)
			sw.Size = UDim2.fromOffset(44,22)
			sw.Position = UDim2.new(1,-56,0.5,-11)
			sw.BackgroundColor3 = Color3.fromRGB(70,70,70)
			Instance.new("UICorner", sw).CornerRadius = UDim.new(1,0)
			sw.Text = ""

			local knob = Instance.new("Frame", sw)
			knob.Size = UDim2.fromOffset(18,18)
			knob.Position = UDim2.fromOffset(2,2)
			knob.BackgroundColor3 = Color3.fromRGB(230,230,230)
			Instance.new("UICorner", knob).CornerRadius = UDim.new(1,0)

			local on = false
			sw.MouseButton1Click:Connect(function()
				on = not on
				tween(sw,{BackgroundColor3 = on and Color3.fromRGB(0,140,255) or Color3.fromRGB(70,70,70)},0.2)
				tween(knob,{Position = on and UDim2.fromOffset(24,2) or UDim2.fromOffset(2,2)},0.2)
				if cfg.Callback then cfg.Callback(on) end
			end)
		end

		function Tab:AddButton(cfg)
			local c = Card(44)

			local b = Instance.new("TextButton", c)
			b.Size = UDim2.new(1,0,1,0)
			b.BackgroundTransparency = 1
			b.Text = cfg.Text
			b.Font = Enum.Font.Gotham
			b.TextSize = 14
			b.TextColor3 = Color3.new(1,1,1)

			b.MouseButton1Click:Connect(function()
				if cfg.Callback then cfg.Callback() end
			end)
		end

		function Tab:AddDropdown(cfg)
			local c = Card(44)
			local label = Instance.new("TextLabel", c)
			label.Text = cfg.Text
			label.Font = Enum.Font.Gotham
			label.TextSize = 14
			label.TextColor3 = Color3.new(1,1,1)
			label.BackgroundTransparency = 1
			label.Position = UDim2.fromOffset(12,0)
			label.Size = UDim2.new(0.5,0,1,0)

			local dropBtn = Instance.new("TextButton", c)
			dropBtn.Size = UDim2.fromOffset(100,22)
			dropBtn.Position = UDim2.new(1,-112,0.5,-11)
			dropBtn.Text = "Select"
			dropBtn.Font = Enum.Font.Gotham
			dropBtn.TextSize = 14
			dropBtn.TextColor3 = Color3.new(1,1,1)
			dropBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
			Instance.new("UICorner", dropBtn).CornerRadius = UDim.new(0,8)

			local open = false
			local listFrame = Instance.new("Frame", c)
			listFrame.Size = UDim2.new(1,0,0,#cfg.List*30)
			listFrame.Position = UDim2.new(0,0,1,0)
			listFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
			listFrame.Visible = false
			Instance.new("UICorner", listFrame).CornerRadius = UDim.new(0,8)

			for i,v in pairs(cfg.List) do
				local option = Instance.new("TextButton", listFrame)
				option.Size = UDim2.new(1,0,0,30)
				option.Position = UDim2.new(0,0,(i-1)*30,0)
				option.Text = v
				option.Font = Enum.Font.Gotham
				option.TextSize = 14
				option.TextColor3 = Color3.new(1,1,1)
				option.BackgroundColor3 = Color3.fromRGB(60,60,60)
				option.MouseButton1Click:Connect(function()
					dropBtn.Text = v
					listFrame.Visible = false
					if cfg.Callback then cfg.Callback(v) end
				end)
			end

			dropBtn.MouseButton1Click:Connect(function()
				open = not open
				listFrame.Visible = open
			end)
		end

		function Tab:AddSlider(cfg)
			local c = Card(50)
			local label = Instance.new("TextLabel", c)
			label.Text = cfg.Text.." 0"
			label.Font = Enum.Font.Gotham
			label.TextSize = 14
			label.TextColor3 = Color3.new(1,1,1)
			label.BackgroundTransparency = 1
			label.Position = UDim2.fromOffset(12,0)
			label.Size = UDim2.new(0.6,0,1,0)

			local slider = Instance.new("Frame", c)
			slider.Size = UDim2.fromOffset(200,6)
			slider.Position = UDim2.new(1,-220,0.5,-3)
			slider.BackgroundColor3 = Color3.fromRGB(70,70,70)
			Instance.new("UICorner", slider).CornerRadius = UDim.new(1,0)

			local knob = Instance.new("Frame", slider)
			knob.Size = UDim2.fromOffset(10,12)
			knob.Position = UDim2.fromOffset(0,-3)
			knob.BackgroundColor3 = Color3.fromRGB(0,140,255)
			Instance.new("UICorner", knob).CornerRadius = UDim.new(1,0)

			local mouseDown = false
			local function update(x)
				local p = math.clamp(x - slider.AbsolutePosition.X,0,slider.AbsoluteSize.X)
				knob.Position = UDim2.fromOffset(p,-3)
				local val = cfg.Min + (cfg.Max - cfg.Min)*(p/slider.AbsoluteSize.X)
				label.Text = string.format("%s %.2f",cfg.Text,val)
				if cfg.Callback then cfg.Callback(val) end
			end

			knob.InputBegan:Connect(function(i)
				if i.UserInputType == Enum.UserInputType.MouseButton1 then
					mouseDown = true
				end
			end)
			knob.InputEnded:Connect(function(i)
				if i.UserInputType == Enum.UserInputType.MouseButton1 then
					mouseDown = false
				end
			end)
			game:GetService("UserInputService").InputChanged:Connect(function(i)
				if mouseDown and i.UserInputType == Enum.UserInputType.MouseMovement then
					update(i.Position.X)
				end
			end)
		end

		function Tab:AddTextbox(cfg)
			local c = Card(44)
			local box = Instance.new("TextBox", c)
			box.PlaceholderText = cfg.Placeholder or ""
			box.Size = UDim2.new(1,-20,1,0)
			box.Position = UDim2.fromOffset(10,0)
			box.Font = Enum.Font.Gotham
			box.TextSize = 14
			box.TextColor3 = Color3.new(1,1,1)
			box.BackgroundColor3 = Color3.fromRGB(40,40,40)
			Instance.new("UICorner", box).CornerRadius = UDim.new(0,8)
			box.FocusLost:Connect(function(enter)
				if enter and cfg.Callback then
					cfg.Callback(box.Text)
				end
			end)
		end

		return Tab
	end

	return Window
end

return Library
