local Library = {}

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local LP = Players.LocalPlayer

local function tween(o,p,t)
    TweenService:Create(o,TweenInfo.new(t or 0.25,Enum.EasingStyle.Quint,Enum.EasingDirection.Out),p):Play()
end

function Library:CreateWindow(cfg)
    local Window = {}

    local gui = Instance.new("ScreenGui")
    gui.Name = "DashiHub"
    gui.ResetOnSpawn = false
    gui.Parent = LP:WaitForChild("PlayerGui")

    -- Floating Open Button
    local openBtn = Instance.new("TextButton", gui)
    openBtn.Size = UDim2.fromOffset(48,48)
    openBtn.Position = UDim2.fromScale(0.03,0.55)
    openBtn.Text = "≡"
    openBtn.Font = Enum.Font.GothamBold
    openBtn.TextSize = 24
    openBtn.BackgroundColor3 = Color3.fromRGB(0,120,255)
    openBtn.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", openBtn).CornerRadius = UDim.new(1,0)

    -- Main Frame
    local main = Instance.new("Frame", gui)
    main.AnchorPoint = Vector2.new(0.5,0.5)
    main.Position = UDim2.fromScale(0.5,0.5)
    main.Size = UDim2.fromScale(0.7,0.75)
    main.BackgroundColor3 = Color3.fromRGB(20,20,25)
    main.Visible = false
    Instance.new("UICorner", main).CornerRadius = UDim.new(0,16)

    -- Exit Button
    local exitBtn = Instance.new("TextButton", main)
    exitBtn.Size = UDim2.fromOffset(36,36)
    exitBtn.Position = UDim2.new(1,-42,0,6)
    exitBtn.Text = "✕"
    exitBtn.Font = Enum.Font.GothamBold
    exitBtn.TextSize = 18
    exitBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
    exitBtn.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", exitBtn).CornerRadius = UDim.new(1,0)

    -- Smooth Open/Close
    openBtn.MouseButton1Click:Connect(function()
        main.Visible = true
        tween(main,{Size=UDim2.fromScale(0.7,0.75)},0.25)
        openBtn.Visible = false
    end)
    exitBtn.MouseButton1Click:Connect(function()
        tween(main,{Size=UDim2.fromScale(0,0)},0.25)
        wait(0.25)
        main.Visible = false
        openBtn.Visible = true
        if Window.StopAll then Window:StopAll() end
    end)

    -- Header
    local header = Instance.new("TextLabel", main)
    header.Size = UDim2.new(1,0,0,46)
    header.BackgroundTransparency = 1
    header.Text = cfg.Title or "Dashi Hub"
    header.Font = Enum.Font.GothamBold
    header.TextSize = 22
    header.TextColor3 = Color3.fromRGB(0,150,255)
    header.TextXAlignment = Enum.TextXAlignment.Left
    header.Position = UDim2.fromOffset(16,0)

    -- Body Scrollable
    local body = Instance.new("ScrollingFrame", main)
    body.Position = UDim2.fromOffset(0,46)
    body.Size = UDim2.new(1,0,1,-46)
    body.BackgroundTransparency = 1
    body.ScrollBarThickness = 6
    body.AutomaticCanvasSize = Enum.AutomaticSize.Y
    body.ScrollBarImageColor3 = Color3.fromRGB(0,120,255)

    -- Sidebar
    local side = Instance.new("Frame", body)
    side.Size = UDim2.fromScale(0.25,1)
    side.BackgroundColor3 = Color3.fromRGB(12,12,15)
    Instance.new("UICorner", side).CornerRadius = UDim.new(0,16)

    local sideList = Instance.new("UIListLayout", side)
    sideList.Padding = UDim.new(0,6)
    sideList.SortOrder = Enum.SortOrder.LayoutOrder

    -- Content
    local content = Instance.new("Frame", body)
    content.Position = UDim2.fromScale(0.27,0)
    content.Size = UDim2.fromScale(0.73,1)
    content.BackgroundTransparency = 1

    local Tabs = {}
    local ActiveToggles = {}

    function Window:CreateTab(name)
        local Tab = {}

        local btn = Instance.new("TextButton", side)
        btn.Size = UDim2.new(1,0,0,40)
        btn.Text = name
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 16
        btn.TextColor3 = Color3.fromRGB(180,180,180)
        btn.BackgroundTransparency = 1
        btn.TextXAlignment = Enum.TextXAlignment.Center
        btn.Position = UDim2.fromOffset(0,0)

        local frame = Instance.new("Frame", content)
        frame.Size = UDim2.fromScale(1,1)
        frame.Visible = false
        frame.BackgroundTransparency = 1

        local layout = Instance.new("UIListLayout", frame)
        layout.Padding = UDim.new(0,6)
        layout.SortOrder = Enum.SortOrder.LayoutOrder

        btn.MouseButton1Click:Connect(function()
            for _,t in pairs(Tabs) do
                t.Frame.Visible = false
                t.Button.TextColor3 = Color3.fromRGB(180,180,180)
            end
            frame.Visible = true
            btn.TextColor3 = Color3.fromRGB(0,150,255)
        end)

        table.insert(Tabs,{Frame=frame,Button=btn})
        if #Tabs==1 then
            frame.Visible = true
            btn.TextColor3 = Color3.fromRGB(0,150,255)
        end

        local function Card(h)
            local c = Instance.new("Frame", frame)
            c.Size = UDim2.new(1,-10,0,h)
            c.BackgroundColor3 = Color3.fromRGB(22,22,26)
            Instance.new("UICorner", c).CornerRadius = UDim.new(0,10)
            return c
        end

        -- Toggle
        function Tab:AddToggle(cfg)
            local c = Card(36)
            local txt = Instance.new("TextLabel", c)
            txt.Text = cfg.Text
            txt.Font = Enum.Font.Gotham
            txt.TextSize = 12
            txt.TextColor3 = Color3.new(1,1,1)
            txt.BackgroundTransparency = 1
            txt.Position = UDim2.fromOffset(12,0)
            txt.Size = UDim2.new(0.6,0,1,0)
            txt.TextXAlignment = Enum.TextXAlignment.Left

            local sw = Instance.new("TextButton", c)
            sw.Size = UDim2.fromOffset(40,18)
            sw.Position = UDim2.new(1,-50,0.5,-9)
            sw.BackgroundColor3 = Color3.fromRGB(70,70,70)
            Instance.new("UICorner", sw).CornerRadius = UDim.new(1,0)
            sw.Text = ""

            local knob = Instance.new("Frame", sw)
            knob.Size = UDim2.fromOffset(16,16)
            knob.Position = UDim2.fromOffset(2,1)
            knob.BackgroundColor3 = Color3.fromRGB(230,230,230)
            Instance.new("UICorner", knob).CornerRadius = UDim.new(1,0)

            local on=false
            sw.MouseButton1Click:Connect(function()
                on = not on
                tween(sw,{BackgroundColor3=on and Color3.fromRGB(0,140,255) or Color3.fromRGB(70,70,70)},0.2)
                tween(knob,{Position=on and UDim2.fromOffset(22,1) or UDim2.fromOffset(2,1)},0.2)
                if cfg.Callback then cfg.Callback(on) end
                ActiveToggles[cfg.Text]=on
            end)
        end

        -- Button
        function Tab:AddButton(cfg)
            local c = Card(36)
            local b = Instance.new("TextButton", c)
            b.Size = UDim2.new(1,0,1,0)
            b.BackgroundTransparency = 1
            b.Text = cfg.Text
            b.Font = Enum.Font.Gotham
            b.TextSize = 12
            b.TextColor3 = Color3.new(1,1,1)
            b.TextXAlignment = Enum.TextXAlignment.Left
            b.Position = UDim2.fromOffset(12,0)
            b.MouseButton1Click:Connect(function()
                local original = b.Position
                tween(b,{Position=UDim2.new(original.X.Scale,original.X.Offset,original.Y.Scale,original.Y.Offset+2)},0.05)
                wait(0.05)
                tween(b,{Position=original},0.05)
                if cfg.Callback then cfg.Callback() end
            end)
        end

        -- Slider (Touch-Friendly, ความเร็ว/ค่าต่างๆ)
        function Tab:AddSlider(cfg)
            local c = Card(36)
            
            local label = Instance.new("TextLabel", c)
            label.Text = string.format("%s: %.2f", cfg.Text, cfg.Min)
            label.Font = Enum.Font.Gotham
            label.TextSize = 12
            label.TextColor3 = Color3.new(1,1,1)
            label.BackgroundTransparency = 1
            label.Position = UDim2.fromOffset(12,0)
            label.Size = UDim2.new(0.6,0,1,0)
            label.TextXAlignment = Enum.TextXAlignment.Left

            local slider = Instance.new("Frame", c)
            slider.Size = UDim2.fromOffset(150,6)
            slider.Position = UDim2.new(1,-170,0.5,-3)
            slider.BackgroundColor3 = Color3.fromRGB(70,70,70)
            Instance.new("UICorner", slider).CornerRadius = UDim.new(1,0)

            local knob = Instance.new("Frame", slider)
            knob.Size = UDim2.fromOffset(16,16)
            knob.Position = UDim2.fromOffset(0,-5)
            knob.BackgroundColor3 = Color3.fromRGB(0,140,255)
            Instance.new("UICorner", knob).CornerRadius = UDim.new(1,0)

            local dragging = false

            local function update(inputX)
                local p = math.clamp(inputX - slider.AbsolutePosition.X, 0, slider.AbsoluteSize.X)
                knob.Position = UDim2.fromOffset(p - knob.AbsoluteSize.X/2, -5)
                local val = cfg.Min + (cfg.Max - cfg.Min) * (p / slider.AbsoluteSize.X)
                label.Text = string.format("%s: %.2f", cfg.Text, val)
                if cfg.Callback then cfg.Callback(val) end
            end

            knob.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or
                   input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    input.Changed:Connect(function()
                        if input.UserInputState == Enum.UserInputState.End then
                            dragging = false
                        end
                    end)
                end
            end)

            slider.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or
                   input.UserInputType == Enum.UserInputType.Touch then
                    update(input.Position.X)
                    dragging = true
                    input.Changed:Connect(function()
                        if input.UserInputState == Enum.UserInputState.End then
                            dragging = false
                        end
                    end)
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or
                                 input.UserInputType == Enum.UserInputType.Touch) then
                    update(input.Position.X)
                end
            end)
        end

        -- Dropdown
        function Tab:AddDropdown(cfg)
            local c = Card(36)
            local label = Instance.new("TextLabel",c)
            label.Text=cfg.Text
            label.Font=Enum.Font.Gotham
            label.TextSize=12
            label.TextColor3=Color3.new(1,1,1)
            label.BackgroundTransparency=1
            label.Position=UDim2.fromOffset(12,0)
            label.Size=UDim2.new(0.5,0,1,0)
            label.TextXAlignment=Enum.TextXAlignment.Left

            local dropBtn = Instance.new("TextButton",c)
            dropBtn.Size = UDim2.fromOffset(100,18)
            dropBtn.Position = UDim2.new(1,-112,0.5,-9)
            dropBtn.Text="Select"
            dropBtn.Font=Enum.Font.Gotham
            dropBtn.TextSize=12
            dropBtn.TextColor3=Color3.new(1,1,1)
            dropBtn.BackgroundColor3=Color3.fromRGB(50,50,50)
            Instance.new("UICorner", dropBtn).CornerRadius=UDim.new(0,6)

            local open=false
            local listFrame = Instance.new("Frame",gui)
            listFrame.Size=UDim2.new(0,dropBtn.AbsoluteSize.X,#cfg.List*24,0)
            listFrame.Position = dropBtn.AbsolutePosition + Vector2.new(0, dropBtn.AbsoluteSize.Y)
            listFrame.BackgroundColor3=Color3.fromRGB(40,40,40)
            Instance.new("UICorner", listFrame).CornerRadius=UDim.new(0,6)
            listFrame.Visible=false

            local options={}
            for i,v in pairs(cfg.List) do
                local option = Instance.new("TextButton", listFrame)
                option.Size=UDim2.new(1,0,0,24)
                option.Position=UDim2.new(0,0,0,(i-1)*24)
                option.Text=v
                option.Font=Enum.Font.Gotham
                option.TextSize=12
                option.TextColor3=Color3.new(1,1,1)
                option.BackgroundColor3=Color3.fromRGB(60,60,60)
                Instance.new("UICorner", option).CornerRadius=UDim.new(0,4)
                option.MouseButton1Click:Connect(function()
                    dropBtn.Text=v
                    listFrame.Visible=false
                    if cfg.Callback then cfg.Callback(v) end
                end)
                table.insert(options,option)
            end

            dropBtn.MouseButton1Click:Connect(function()
                open = not open
                listFrame.Visible=open
                local abs = dropBtn.AbsolutePosition
                listFrame.Position = UDim2.new(0, abs.X, 0, abs.Y + dropBtn.AbsoluteSize.Y)
            end)
        end

        -- TextBox
        function Tab:AddTextbox(cfg)
            local c = Card(36)
            local box = Instance.new("TextBox",c)
            box.PlaceholderText=cfg.Placeholder or ""
            box.Size=UDim2.new(1,-20,1,0)
            box.Position=UDim2.fromOffset(10,0)
            box.Font=Enum.Font.Gotham
            box.TextSize=12
            box.TextColor3=Color3.new(1,1,1)
            box.BackgroundColor3=Color3.fromRGB(40,40,40)
            Instance.new("UICorner", box).CornerRadius=UDim.new(0,6)
            box.FocusLost:Connect(function(enter)
                if enter and cfg.Callback then cfg.Callback(box.Text) end
            end)
        end

        return Tab
    end

    function Window:StopAll()
        for k,v in pairs(ActiveToggles) do
            ActiveToggles[k]=false
        end
    end

    return Window
end

return Library
